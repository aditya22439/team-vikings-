<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login â€¢ Smart Road Damage Response</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Cormorant+Garamond:wght@600&display=swap");

      :root {
        --bg: #f4f7ff;
        --panel: #ffffff;
        --ink: #1c2333;
        --muted: #5b6475;
        --accent: #ff6b6b;
        --border: #e1e6f0;
        --shadow: 0 20px 50px rgba(28, 35, 51, 0.12);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Outfit", "Segoe UI", sans-serif;
        color: var(--ink);
        min-height: 100vh;
        background:
          radial-gradient(circle at 18% 15%, rgba(255, 214, 214, 0.7), transparent 45%),
          radial-gradient(circle at 85% 10%, rgba(197, 224, 255, 0.8), transparent 40%),
          radial-gradient(circle at 70% 80%, rgba(255, 239, 200, 0.7), transparent 45%),
          linear-gradient(180deg, #f6f8ff 0%, #eef2fb 100%);
        display: grid;
        place-items: center;
        padding: 40px 6vw;
      }

      .card {
        width: min(480px, 100%);
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 26px;
        box-shadow: var(--shadow);
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 18px;
      }

      .brand-logo {
        width: 64px;
        height: 64px;
        object-fit: cover;
        border-radius: 50%;
        background: #fff;
        border: 2px solid var(--border);
        padding: 4px;
      }

      h1 {
        margin: 0 0 8px;
        font-size: 1.5rem;
      }

      p {
        margin: 0 0 18px;
        color: var(--muted);
      }

      form {
        display: grid;
        gap: 12px;
      }

      label {
        font-size: 0.9rem;
        color: var(--muted);
      }

      input,
      select {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid var(--border);
        font-size: 0.95rem;
      }

      .btn {
        border: none;
        background: linear-gradient(120deg, var(--accent), #3c91e6);
        color: #fff;
        padding: 12px 16px;
        border-radius: 999px;
        cursor: pointer;
        font-size: 0.95rem;
      }

      .link {
        margin-top: 14px;
        font-size: 0.9rem;
        color: var(--muted);
      }

      .link a {
        color: var(--ink);
        text-decoration: none;
        border-bottom: 1px solid transparent;
      }

      .link a:hover {
        border-bottom-color: var(--accent);
      }

      .hint {
        margin: 2px 0 0;
        font-size: 0.78rem;
        color: var(--muted);
      }

      .status {
        margin-top: 10px;
        font-size: 0.88rem;
        min-height: 1.2em;
      }

      .status.error {
        color: #b42318;
      }

      .status.success {
        color: #067647;
      }

      .divider {
        margin: 18px 0 12px;
        height: 1px;
        background: var(--border);
      }
    </style>
  </head>
  <body>
    <div class="card">
      <div class="brand">
        <img
          class="brand-logo"
          src="assets/viking-logo.jpeg"
          alt="Viking logo"
          width="64"
          height="64"
        />
        <div>
          <div style="font-family: 'Cormorant Garamond', serif; font-size: 1.2rem">
            Smart Road Damage Response
          </div>
          <div style="font-size: 0.75rem; color: var(--muted); letter-spacing: 0.2em">
            TEAM VIKINGS
          </div>
        </div>
      </div>
      <h1>Login</h1>
      <p>Select account type, then enter your credentials.</p>
      <form id="login-form" novalidate>
        <div>
          <label for="user-id">User ID</label>
          <input id="user-id" type="text" placeholder="Your unique user ID" required />
        </div>
                <div>
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="Your password" required />
        </div>
        <div>
          <label for="login-role">Login As</label>
          <select id="login-role" required>
            <option value="Developer">Developer</option>
            <option value="Municipality">Municipality</option>
          </select>
        </div>
        <button class="btn" type="submit">Login</button>
      </form>
      <div class="status" id="login-status" aria-live="polite"></div>

      <div class="divider"></div>
      <form id="forgot-form" novalidate>
        <div>
          <label for="forgot-email">Forgot User ID / Password</label>
          <input id="forgot-email" type="email" placeholder="Enter your registered email" required />
          <p class="hint">We will send your User ID and password to your email.</p>
        </div>
        <button class="btn" type="submit">Send Credentials</button>
      </form>
      <div class="status" id="forgot-status" aria-live="polite"></div>
      <div class="link">
        New user? <a href="signin.html">Sign In</a>
      </div>
      <div class="link">
        Back to <a href="index.html">Overview</a>
      </div>
    </div>
    <script>
      const USER_STORE_KEY = "srdr_users_v1";
      const CURRENT_USER_KEY = "srdr_current_user_v1";

      const ALLOWED_ROLES = ["Developer", "Municipality"];
      const loginForm = document.getElementById("login-form");
      const forgotForm = document.getElementById("forgot-form");
      const loginStatus = document.getElementById("login-status");
      const forgotStatus = document.getElementById("forgot-status");

      function getUsers() {
        try {
          const raw = localStorage.getItem(USER_STORE_KEY);
          const parsed = raw ? JSON.parse(raw) : [];
          return Array.isArray(parsed) ? parsed : [];
        } catch (err) {
          return [];
        }
      }

      function setStatus(element, message, type) {
        element.textContent = message;
        element.className = `status ${type}`;
      }

      function isAllowedRole(role) {
        return ALLOWED_ROLES.includes(role);
      }

      loginForm.addEventListener("submit", (event) => {
        event.preventDefault();
        setStatus(loginStatus, "", "");

        const userIdInput = document.getElementById("user-id").value.trim().toUpperCase();
        const passwordInput = document.getElementById("password").value;
        const roleInput = document.getElementById("login-role").value;

        if (!userIdInput || !passwordInput || !roleInput) {
          setStatus(loginStatus, "Please enter User ID, Password, and role.", "error");
          return;
        }

        if (!isAllowedRole(roleInput)) {
          setStatus(loginStatus, "Please select a valid login type.", "error");
          return;
        }

        const users = getUsers();
        const user = users.find((item) => item.userId === userIdInput);

        const normalizeRole = (role) => {
          const value = String(role || "").toLowerCase();
          if (value.includes("developer")) return "Developer";
          if (value.includes("municipality")) return "Municipality";
          return role;
        };

        if (!user || user.password !== passwordInput) {
          setStatus(loginStatus, "Invalid User ID or Password.", "error");
          return;
        }

        const userRole = normalizeRole(user.role);
        if (!isAllowedRole(userRole) || userRole !== roleInput) {
          setStatus(loginStatus, "Selected role does not match this user account.", "error");
          return;
        }

        localStorage.setItem(
          CURRENT_USER_KEY,
          JSON.stringify({
            userId: user.userId,
            name: user.name,
            email: user.email,
            role: userRole,
          }),
        );

        setStatus(loginStatus, `Login successful. Welcome ${user.name}.`, "success");
        window.location.href = "index.html";
      });

      forgotForm.addEventListener("submit", (event) => {
        event.preventDefault();
        setStatus(forgotStatus, "", "");

        const emailInput = document.getElementById("forgot-email").value.trim().toLowerCase();

        if (!emailInput) {
          setStatus(forgotStatus, "Please enter your registered email.", "error");
          return;
        }

        const users = getUsers();
        const user = users.find((item) => item.email === emailInput);

        if (!user) {
          setStatus(forgotStatus, "No account found for this email.", "error");
          return;
        }

        const subject = encodeURIComponent("Smart Road Damage Response - Credentials");
        const body = encodeURIComponent(
          `Hello ${user.name},\n\nYour credentials are:\nUser ID: ${user.userId}\nPassword: ${user.password}\n\nPlease login and change your password if needed.`,
        );

        window.location.href = `mailto:${user.email}?subject=${subject}&body=${body}`;
        setStatus(forgotStatus, "Email draft opened with your credentials.", "success");
      });
    </script>
  </body>
</html>
